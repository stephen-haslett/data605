---
title: "DATA 605 Discussion 13"
subtitle: "What factors determine used car prices"
author: "Stephen Haslett"
date: "11/18/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load the necessary libraries.
library(dplyr)
library(tidyverse)
library(knitr)
library(ggplot2)
```

#### Assignment Question
Using R, build a multiple regression model for data that interests you. Include in this model at least one quadratic term, one dichotomous term, and one dichotomous vs. quantitative interaction term.  Interpret all coefficients. Conduct residual analysis.  Was the linear model appropriate? Why or why not?

#### Assignment Response.
My response to this weeks discussion topic was inspired by a paper by Shounda Kuiper called "Introduction to Multiple Regression: How Much Is Your Car Worth?" The data set I will use for this discussion was collected from Kelly Blue Book comprising of 804 observations of used GM cars. The dataset can be downloaded via the [Journal of Statistics Education](http://jse.amstat.org/jse_data_archive.htm) data archive (the original file name is kuiper.xls).

##### Dataset Exploration
First we will import the dataset into R and then take a brief look at the data.
```{r dataSetUp}
# Load the Kelly Blue Book used GM cars dataset into R. 7 of the columns in the data set
# contain only NA values, so we only import the first 12 columns that contain actual data.
cars_dataset <- read.csv('https://raw.githubusercontent.com/stephen-haslett/data605/data605-week-13/KellyBlueBookCarSales.csv')[ ,1:12]

# Attach the dataset so we can easily access the variables.
attach(cars_dataset)

# Look at a sample of the dataset, and count the number of observations.
kable(head(cars_dataset), format = 'markdown')
nrow(cars_dataset)
```

As we can see from the above table, the dataset contains **804** observations of used GM cars, and 12 variables: _Price_, _Mileage_, _Make_, _Model_, _Trim_, _Type_, _Cylinder_, _Liter_, _Doors_, _Cruise_, _Sound_, and _Leather_.

The aim of this exercise is to establish which of the following variables are the best predictors of car price: _Mileage_, _Make_, _Model_, _Trim_, _Type_, _Cylinder_, _Liter_, _Doors_, _Cruise_, _Sound_, _Leather_. 

\ 

#### Linear Models

\ 

##### Mileage vs price model
We will start with the mileage variable as this is the most obvious predictor of car price. For this, we will run a simple linear model to see if this is indeed the case.
```{r, priceMileageModel}
# Run a model to check if car mileage has a linear relationship with car price.
priceMileageModel <- lm(Price ~ Mileage, cars)
summary(priceMileageModel)
```

The **4.68** p-value reported by the model summary tells us that there is a strong relationship between the mileage of a car and its price.
However, the R-squared value is only **0.02** which means mileage only explains **2**% of the variance. To explore this further, we can plot the results visually
to get a better picture of the variance.

```{r, priceMileagePlot}
plot(Price ~ Mileage, cars, main = 'Mileage Vs Car Price')
abline(priceMileageModel, col = "red", lwd = 3)
```

From the above plot, we can see that there is a lot of variation in the data, with a lot of outliers. Despite this, there is still
a strong relatioship between mileage and price. In order to explain some of those outliers and increase the R-squared value of our model,
let's pull in some more variables.

```{r, priceMileageModelExpanded}
# Run a new Price ~ Mileage model, but add the Make and Type variables to
# the model to see if our R-squared value increases.
priceMultipleModel <- lm(Price ~ Mileage + Make + Type, cars)
summary(priceMultipleModel)
```

After adding the Make and Type variables to the model, our R-squared values has jumped from **0.02** to **0.78** which is a significant increase.
We have gone from explaining **2**% of the variance, to explaining **78**% of the variance. 

Next I want to add a **dichotomous** variable to the model to see what effect it has on price. We will add the dichotomous variable "Leather" to the model. 

```{r, priceMileageModelExpanded2}
# Add the dichotomous term Leather to the model.
priceMultipleModel <- lm(Price ~ Mileage + Make + Type + Leather, cars)
summary(priceMultipleModel)
```

After adding the dichotomous variable Leather to the model, it appears that our R-squared values was slightly increased, so while it does have significance in terms of price, it appears the significance is marginal.

Finally we will add the **quadratic** variable Cylinder to the model.

```{r, priceMileageModelExpanded3}
# Add the quadratic term Cylinder to the model.
priceMultipleModel <- lm(Price ~ Mileage + Make + Type + Leather + Cylinder, cars)
summary(priceMultipleModel)
```



Adding the quadratic variable Cylinder to our model resulted in a significant increase in our R-squared value. Our model now explains **91**% of the variance. 
